# 20240125-加密算法与安全

## 概念

1. **明文**：

明文是指原始信息或数据的原始形式，未经加密的状态，可以是文本、数字或任何其他形式的

数据。

明文是容易读懂的，没有经过任何形式的隐藏或加密处理。

2. **密文**：

密文是指经过加密后的信息或数据。密文通常看起来是随机的或没有明显意义的字符序列。

密文的目的是为了保护数据的隐私性，防止未经授权的人员理解或篡改数据。

3. **密钥**：

密钥是用于加密和解密数据的工具。它可以是一个数字、一串字符或更复杂的数据结构。

在加密过程中，密钥用于转换明文为密文。在解密过程中，又用于将密文转换回明文。

密钥的安全性对保护数据至关重要。

4. **加密**：

加密是一个过程，通过它，明文使用一定的方法（加密算法）和密钥被转换成密文。

加密的目的是保护数据的机密性，使未授权的人无法理解信息的真实内容。

5. **解密**：

解密是加密的逆过程。它使用密钥将密文转换回原始的明文形式。

只有拥有正确密钥的人才能解密并获得原始数据。

6. **加密算法**：

加密算法是一系列用于加密和解密数据的指令或规则。

有多种加密算法，每种都有其独特的特点和用途，如AES、RSA、DES等。

不同的算法可能使用不同类型的密钥（如对称密钥或非对称密钥）。

##  对称加密和非对称加密

对称加密和非对称加密是两种主要的加密方法，它们在保护数据安全性方面发挥着关键作用。下面将分

别解释这两种加密方法的特点和工作原理。

###  对称加密

对称加密是一种加密方法，其中加密和解密使用相同的密钥。其特点和工作原理如下：

- **密钥共享**：发送方和接收方使用相同的密钥进行加密和解密。

- **加密速度快**：由于算法相对简单，对称加密通常比非对称加密更快，适合大量数据的加密。

- **主要挑战**：密钥的分发和管理。因为密钥必须在通信双方之间安全共享，任何泄露都可能导致安全

风险。

- **常见算法**：
  - AES（Advanced Encryption Standard，高级加密标准）
  - DES（Data Encryption Standard，数据加密标准）
  - 3DES（Triple DES，三重数据加密算法）等。

对称加密适用于那些对数据处理速度要求较高且能够安全管理密钥的场景。

###  非对称加密

非对称加密，也称为公钥加密，使用一对密钥：一个公钥和一个私钥。这两个密钥在数学上是相关联

的，但不能通过其中一个推导出另一个。其特点和工作原理如下：

- **公钥和私钥**：公钥可以公开分享，用于加密数据；私钥是保密的，只有所有者才知道，用于解密数

据。

- **安全性高**：由于密钥对的独特性，非对称加密通常被认为比对称加密更安全。

- **速度较慢**：相比对称加密，非对称加密在处理数据时速度较慢，因此不太适合大量数据的加密。

- **常见算法**：
  - RSA（由 Rivest、Shamir 和 Adleman 三人的名字首字母组成）
  - DSA（Digital Signature Algorithm，数字签名算法）
  - ECC（Elliptic Curve Cryptography，椭圆曲线密码学）

非对称加密主要用于安全密钥交换、数字签名和身份验证等场景。

> **对称加密**算法在**大量数据加密**时可以提供更好的性能，而**非对称加密**算法在**数据安全性和密钥分发**上有优势。在实际应用中，这两种加密算法通常会**结合使用**，以达到既安全又高效的效果。

#### 非对称加密在数学上的原理

非对称加密的数学原理主要基于数论和离散数学中的一些难题，如大数分解问题、离散对数问题和椭圆曲线离散对数问题等。

以最常见的 RSA 非对称加密算法为例，其数学原理主要基于大数分解问题。RSA 算法的公钥和私钥生成过程如下：

1. 随机选择两个大的质数 p 和 q。
2. 计算 n = p * q，这个 n 就是公钥和私钥的一部分。
3. 计算 φ(n) = (p - 1) * (q - 1)，这个 φ(n) 是 Euler's totient function。
4. 选择一个整数 e，使得 1 < e < φ(n)，且 e 和 φ(n) 互质，这个 e 就是公钥的另一部分。
5. 计算一个整数 d，使得 (d * e) % φ(n) = 1，这个 d 就是私钥的另一部分。

在这个过程中，如果知道 n 和 e（即公钥），要想得到 d（即私钥），就需要分解 n 来得到 p 和 q，然后计算 φ(n)，这就是一个大数分解问题，当 p 和 q 足够大时，这个问题是非常难解的，这就保证了 RSA 算法的安全性。

其他的非对称加密算法，如 DSA 和 ECC，其数学原理则基于离散对数问题和椭圆曲线离散对数问题，这些问题同样在计算上是非常困难的，从而保证了这些算法的安全性。

####  加密信息

非对称加密用于加密信息时，主要目的是保证信息传输的机密性。其过程如下：

1. **使用公钥加密**：

发送方使用接收方的公钥对信息进行加密。

由于只有接收方拥有对应的私钥，因此只有接收方能解密这个信息。

2. **使用私钥解密**：

接收方使用自己的私钥解密信息。

这确保了即使加密的信息在传输过程中被拦截，拦截者也无法解读信息内容。

3. **保护机密性**：

这种方法主要用于保护信息内容不被未授权的第三方读取。

#### 身份认证

在身份认证中，非对称加密主要用于验证一个实体的身份，确保消息的来源是可信的。其过程通常涉及

数字签名，如下所示：

1. **使用私钥生成签名**：

发送方使用自己的私钥对信息或信息的散列（hash）值进行加密，生成数字签名。

这个签名绑定于特定的信息和发送者的身份。

2. **使用公钥验证签名**：

接收方使用发送方的公钥来解密签名。

接收方同时对原始信息进行同样的散列处理，然后比较散列值是否一致。

3. **确保身份和完整性**：

如果使用公钥解密的结果与原始信息的散列值一致，说明信息确实来自声明的发送方，并且在

传输过程中未被篡改。

这种方法主要用于验证信息的真实性和发送者的身份。

#### 综合应用

在实际应用中，非对称加密经常被用于同时实现加密信息和身份认证。例如，在发送一个加密电子邮件

时，发送方可以使用接收方的公钥对信息进行加密（保护机密性），同时使用自己的私钥生成数字签名

（保证身份认证）。接收方则使用自己的私钥解密信息，并使用发送方的公钥验证数字签名。

这种综合应用提供了一个既安全又有效的方式来保护信息内容，同时验证通信双方的身份，是现代数字通信和网络安全的重要组成部分。

### 结合使用

在实际应用中，对称加密和非对称加密往往结合使用。例如，非对称加密可以用于安全地交换对称加密的密钥，一旦密钥交换完成，数据传输则使用对称加密进行，这样既保证了密钥交换的安全性，又能利用对称加密处理数据的高效性。这种方法在许多现代加密协议和通信标准中被广泛采用，如HTTPS、SSL/TLS等。

## 摘要算法

摘要算法，也被称为散列函数（Hash Function），是一种在计算机科学和密码学中广泛使用的重要技术。它的主要作用是将任意长度的输入数据（通常称为“消息”）转换为固定长度的、通常较短的值，这个值被称为散列值或摘要。

### 散列函数的关键特性

1. **确定性**：对于同一个输入，散列函数总是产生相同的输出。
2. **高效性**：散列函数的计算过程快速，对于任何大小的输入都能在短时间内产生散列值。
3. **不可逆性**：从散列值不可能反推出原始的输入数据。这是因为散列函数是单向的。
4. **冲突抵抗**：理想的散列函数应该最小化冲突，即两个不同的输入产生相同散列值的情况。完全避免冲突是不可能的，因为输出的长度是固定的，但好的散列函数能使这种情况极其罕见。

### 散列函数的应用

1. **数据完整性验证**：通过比较数据的散列值，可以验证数据是否在传输或存储过程中被篡改。
2. **安全密码存储**：存储用户密码的散列值，而不是密码本身，以提高安全性。
3. **数字签名**：散列函数用于生成数字签名，保证消息的真实性和完整性。

### 常见的散列函数

**MD5**：产生128位散列值，但现在已被认为不够安全，容易受到碰撞攻击。

**SHA-1**：产生160位散列值，安全性比MD5高，但在高安全需求的领域也已逐渐被淘汰。

**SHA-256**：属于SHA-2家族，产生256位散列值，目前广泛用于加密货币和网络安全领域。

## 数字签名

数字签名是一种用于验证数字**信息完整性**和**真实性**的技术，广泛应用于电子商务、软件分发、电子邮件

等领域。它使用加密算法来模拟传统的手写签名和印章，但在数字环境中提供更高的安全保障。

### 原理和过程

数字签名通常基于非对称加密技术，涉及一个**私钥（用于签名）**和一个**公钥（用于验证签名）**。其基本

过程包括：

#### 签名生成

- 发送者首先将消息通过哈希函数转换为一个哈希值。
- 然后，发送者使用自己的私钥对这个哈希值进行加密，生成的结果就是数字签名。
- 发送者将原始消息和数字签名一起发送给接收者。

#### 签名验证

- 接收者收到消息和数字签名后，使用发送者的公钥对数字签名进行解密，得到原始的哈希值。
- 接收者同时也将收到的消息通过同样的哈希函数转换为一个哈希值。
- 接收者比较这两个哈希值，如果它们相同，那么就说明消息没有被篡改，发送者的身份也得到了验证。

这个过程的安全性基于非对称加密的数学原理。私钥只有发送者知道，而公钥是公开的。只有真正的发送者才能生成一个可以用公钥解密的数字签名，这就保证了发送者的身份。同时，由于哈希函数的特性，即使只是消息的一小部分被修改，生成的哈希值也会完全不同，这就保证了消息的完整性。

> 这其中说到的通过哈希函数转换为一个哈希值，用的就是摘要算法，比如SHA-256，MD5等算法，获得哈希值。

### 特点和优势

- **验证身份**：数字签名可以验证消息的发送者身份，确保消息来源的真实性。

- **保证完整性**：通过比较散列值，可以确保消息在传输过程中未被篡改。

- **不可否认性**：发送者不能否认他们签名的消息，因为只有他们的私钥才能生成签名。

## 数字证书

> [最通俗易懂的讲解HTTPS的加密原理【多图、易懂】【有误 等待后续勘误】-CSDN博客](https://blog.csdn.net/weixin_43757333/article/details/124881446)

解决公钥传输信任问题。

数字证书是一种用于验证实体（如个人、服务器、客户端或组织）身份的电子文档。它使用公钥基础设

施（PKI）技术，通过将公钥与身份信息相结合，提供了一种安全验证方式。数字证书类似于现实世界中

的身份证或护照。

### 核心组成

数字证书通常包含以下信息：

1. **证书持有者的身份信息**：如名称、电子邮件地址、组织信息等。
2. **证书持有者的公钥**：用于非对称加密和数字签名验证。
3. **颁发机构（CA）的信息**：证书是由谁颁发的，比如VeriSign、Let's Encrypt等。
4. **有效期限**：证书的有效开始和结束日期。
5. **证书序列号**：唯一标识证书的编号。
6. **数字签名**：证书颁发机构（CA）使用自己的私钥对证书进行的签名，以确保证书的真实性。

比如微信支付等场景中：`apiclient_cert.pem` 通常用于双向 SSL 认证。在这种情况下，`apiclient_cert.pem` 包含了应用的公钥证书，而对应的 `apiclient_key.pem` 文件包含了私钥。这两个文件一起用于在应用与微信支付服务器之间建立安全的、可验证的连接。

这个文件通常由证书颁发机构（CA）签发，或者由你自己生成（自签名证书）。它的内容是以 Base64 编码的 X.509 证书，通常包括证书的持有者、证书的颁发者、有效期、以及一个公钥等信息。

**apiclient_cert.pem**证书文件

![image-20240126174814518](https://s2.loli.net/2024/01/26/H1dkepl3hVOYjUW.png)

apiclient_key.pem 私钥

![image-20240126175216385](https://s2.loli.net/2024/01/26/TbCIADcVHF742US.png)

### 功能和作用

1. **身份验证**：证书确保了公钥属于声明的实体，帮助用户或系统验证对方的身份。
2. **建立安全通信**：如在HTTPS中，服务器的数字证书用于建立安全的SSL/TLS连接。
3. **数字签名和加密**：证书中的公钥可以用于解密由相应私钥加密的数据，或验证数字签名。

### 颁发过程

1. **生成密钥对**：证书申请者首先生成一对密钥（公钥和私钥）。
2. **提交证书签名请求（CSR）**：随后，申请者创建CSR，其中包括公钥和身份信息。
3. **CA处理请求**：证书颁发机构验证申请者的身份信息，然后使用CA的私钥对包含申请者公钥的证书

进行签名。

4. **颁发证书**：一旦验证完成，CA将签名的数字证书发放给申请者。

### 应用场景

**网站安全**：用于HTTPS，加密网站和访问者之间的通信。

**电子邮件加密和签名**：证书中的公钥用于验证发送方的身份，以及加密和解密电子邮件。

**代码签名**：开发者使用证书来签名他们的软件，用户可以验证软件的真实性。

## HTTPS

> [HTTPS加密原理 - 风铃同学 - 博客园 (cnblogs.com)](https://www.cnblogs.com/Yfling/p/6670495.html)
>
> [HTTPS的加密原理 - 黄增松 - 博客园 (cnblogs.com)](https://www.cnblogs.com/huangzs/p/13964095.html)

HTTP + 加密 + 认证 + 完整性保护 = HTTPS

**使用两把密钥的公开密钥加密**

公开密钥加密使用一对非对称的密钥。一把叫做私钥，另一把叫做公钥。私钥不能让其他任何人知道，而公钥则可以随意发布，任何人都可以获得。使用公钥加密方式，发送密文的一方使用对方的公钥进行加密处理，对方收到被加密的信息后，再使用自己的私钥进行解密。利用这种方式，不需要发送用来解密的私钥，也不必担心密钥被攻击者窃听而盗走。

### 过程

①服务器把自己的公钥登录至数字证书认证机构。
②数字证书机构把自己的私有密钥向服务器的公开密码部署数字签名并颁发公钥证书。
③客户端拿到服务器的公钥证书后，使用数字证书认证机构的公开密钥，向数字证书认证机构验证公钥证书上的数字签名。以确认服务器公钥的真实性。
④使用服务器的公开密钥对报文加密后发送。
⑤服务器用私有密钥对报文解密。

### 认证

为了确保客户端能够确认公钥就是想要访问的网站的公钥，引入了数字证书的概念，由于证书存在一级一级的签发过程，所以就出现了证书链，在证书链中的顶端的就是根CA。

所谓的认证即确认对方身份，单向认证一般是指客户端确认服务端身份，双向认证则是指在客户端需要确认服务端身份的同时，服务端也需要确认客户端的身份。

- 单向认证

![img](https://s2.loli.net/2024/01/29/7WRyJHjlhnOKwEv.png)

- 双向认证
  

![img](https://s2.loli.net/2024/01/29/BLZbV3r2NU8ptWk.png)

### 数字签名的制作过程

> [彻底搞懂HTTPS的加密原理 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/43789231)

数字签名的制作过程：

1. CA机构拥有非对称加密的私钥和公钥。
2. CA机构对证书明文数据T进行hash。
3. 对hash后的值用私钥加密，得到数字签名S。

明文和数字签名共同组成了数字证书，这样一份数字证书就可以颁发给网站了。
那浏览器拿到服务器传来的数字证书后，如何验证它是不是真的？（有没有被篡改、掉包）

### 浏览器验证过程

1. 拿到证书，得到明文T，签名S。
2. 用CA机构的公钥对S解密（由于是浏览器信任的机构，所以浏览器保有它的公钥。），得到S’。
3. 用证书里指明的hash算法对明文T进行hash得到T’。
4. 显然通过以上步骤，T’应当等于S‘，除非明文或签名被篡改。所以此时比较S’是否等于T’，等于则表明证书可信。