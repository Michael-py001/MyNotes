# 20230809-JS中的堆内存与栈内存

## 什么是堆内存？

**堆内存是指在程序运行时动态分配的内存空间**，用于存储程序中的**对象和数据结构**。堆内存是由程序员**手动分配和释放**的，通常使用 `new` 关键字来分配内存空间，使用 `delete` 关键字来释放内存空间。

在 JavaScript 中，所有的对象都存储在堆内存中。当我们创建一个对象时，JavaScript 引擎会在堆内存中分配一块空间来存储这个对象，并返回一个指向这个对象的引用。当这个对象不再被引用时，JavaScript 引擎会自动回收这块内存空间，以便其他对象可以使用。

需要注意的是，堆内存是由程序员手动管理的，如果程序员没有正确地分配和释放内存空间，就会导致内存泄漏和程序崩溃等问题。因此，在编写程序时，需要注意正确地管理堆内存，避免出现内存泄漏等问题。

## 什么是栈内存？

除了对象以外，JavaScript 中的其他值都存储在**栈内存**中。**栈内存是一种自动分配和释放的内存空间，用于存储程序中的基本数据类型和函数调用栈等信**息。

JavaScript 中的基本数据类型包括数字、字符串、布尔值、null 和 undefined 等。当我们创建一个基本数据类型的变量时，JavaScript 引擎会在栈内存中分配一块空间来存储这个变量，并将变量的值存储在这个空间中。当这个变量不再被使用时，JavaScript 引擎会自动释放这块内存空间，以便其他变量可以使用。

需要注意的是，栈内存是由 JavaScript 引擎**自动管理**的，程序员**无法**手动分配和释放栈内存空间。因此，在编写程序时，不需要考虑栈内存的管理问题，只需要注意正确地使用基本数据类型和函数调用即可。

## 什么是函数调用栈？

函数调用栈是指在函数调用过程中，用于存储函数调用信息的栈结构。当一个函数被调用时，JavaScript 引擎会在栈内存中分配一块空间来存储函数调用信息，并将这个空间压入函数调用栈中。当函数执行完毕后，JavaScript 引擎会将这个空间从函数调用栈中弹出，并释放这块内存空间。

## 函数中的执行上下文

在 JavaScript 中，函数调用时会**创建一个新的执行上下文（Execution Context）**，用于存储函数的**局部变量**、**参数**和**函数调用栈等信息**。执行上下文是一个栈结构，每当一个函数被调用时，就会创建一个新的执行上下文，并将其压入执行上下文栈中。当函数执行完毕后，执行上下文会被弹出栈，并被销毁。

在每个执行上下文中，都会分配一块内存空间来存储函数的局部变量和参数。这些变量和参数只在函数执行期间存在，并在函数执行完毕后被销毁。因此，每次函数调用时都会创建一个新的执行上下文和一块新的内存空间来存储局部变量和参数。

- 函数调用时都会创建一个新的执行上下文和一块新的内存空间来存储局部变量和参数，这个内存是指堆内存吗?

  不是，函数的局部变量和参数是存储在栈内存中的，而不是堆内存。每当一个函数被调用时，JavaScript 引擎会在栈内存中分配一块空间来存储函数的局部变量和参数，这个空间只在函数执行期间存在，并在函数执行完毕后被销毁。

## 栈内存和堆内存的区别

**栈内存和堆内存的区别在于它们的分配和释放方式，而不是它们存储的数据类型**。具体来说，**栈内存是一种自动分配和释放的内存空间**，用于存储程序中的基本数据类型和函数调用栈等信息。栈内存的分配和释放是由 JavaScript 引擎自动完成的，**程序员无法手动分配和释放栈内存空间**。

**堆内存是一种动态分配和释放的内存空间**，用于存储程序中的对象和数据结构。**堆内存的分配和释放是由程序员手动完成的**，通常使用 `new` 关键字来分配内存空间，使用 `delete` 关键字来释放内存空间。

在 JavaScript 中，所有的数据类型都可以存储在栈内存或堆内存中，具体取决于数据的类型和生命周期。基本数据类型和函数调用栈等信息通常存储在栈内存中，因为它们的生命周期很短，只在函数执行期间存在，并在函数执行完毕后被销毁。而对象和数据结构等动态分配的内存空间通常存储在堆内存中，因为它们的生命周期较长，需要手动分配和释放内存空间。

需要注意的是，栈内存和堆内存的分配和释放方式不同，因此它们的性能特征也不同。栈内存的分配和释放速度较快，但是栈内存的大小有限，不能存储过大的数据。堆内存的分配和释放速度较慢，但是堆内存的大小较大，可以存储较大的数据。在编写程序时，需要根据数据的类型和生命周期选择合适的内存空间来存储数据，以提高程序的性能和效率。