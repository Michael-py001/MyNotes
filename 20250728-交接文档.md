# FormItem

`FormItem` 组件是基于 `ant-design-vue` 的 `form-item` 组件进行封装的，支持 `ant-design-vue` 的大部分表单组件，同时也支持自定义组件。

在项目中作为表单原子组件，一般不单独使用，已经封装在`FormPage`、`FormModal`、`SearchForm`组件中，以上的组件均以`FormItem`为基础并继承其属性。

## FormItem Props

| 参数 | 说明 | 类型 | 默认值 |
| --- | --- | --- | --- |
| type / el | 渲染组件的类型，见下方[组件类型](#formitem-组件支持的类型) | _string_ |  |
| formData | 表单数据对象，必须是响应式数据 | _object_ |  |
| selfProps | 给外层`ant-design-vue`的`form-item`组件设置的属性，具体属性值可参考[Form.Item 参数](https://2x.antdv.com/components/form-cn#API) | _object_ |  |
| props | 给当前`type`类型组件设置的html标签属性，如 `style` ， `disabled` 等 | _object_ |  |
| labelAlign | label 标签的文本对齐方式 | _'left' \| 'right'_ | `'left'` |
| align | `form-item`的对齐方式 | _'left' \| 'center' \| 'around'_ | `'left'` |
| style | `form-item`外层 style 样式属性 | _object_ |  |
| name | 表单名称 | _string_ |  |
| beforeText | 给`form-item`前面添加的文字 | _string_ |  |
| afterText | 给`form-item`后面添加的文字 | _string_ |  |
| options | options 数据，适用于`select`,`radio-group`,`check-box-group`等类型组件。 | _array<{label,value}>_ | `[]` |
| valueKey | 用于修改 options 数据中 key 值 | _string_ | `value` |
| labelKey | 用于修改 options 数据中 label 值 | _string_ | `label` |
| label | label 标签的文本 | _string \| slot_ |  |
| event | 给当前`type`类型组件设置的事件 | _object_ |  |
| rules | 表单验证规则 | _object \| array_ |  |
| textBold | 给`text`类型组件设置文本加粗 | _boolean_ | `false` |
| disabled | 禁用当前组件 | _boolean_ | `false` |
| autoLabelHeight | 当`label`显示空间不足时，可设置为`true`，`label`会自适应高度显示 | _boolean_ | `false` |
| hideRequiredMark | 隐藏当前字段的`*`必选符号 | _boolean_ | `false` |
| addRequiredMark | 给当前字段添加`*`必选符号 | _boolean_ | `false` |
| formSlot | 自定义表单组件，适用于自定义组件 | _string_ |  |
| afterSlot | 自定义表单组件后面的内容，适用于自定义组件 | _string_ |  |
| beforeSlot | 自定义表单组件前面的内容，适用于自定义组件 | _string_ |  |

## FormItem 组件支持的类型

目前 `type` 支持的类型有：

| type 类型 | 说明 |
| --- | --- |
| text | 自定义 纯文本组件 |
| city-picker | 自定义 地区联动选择器组件 ，支持省、市、区、街道 |
| select | 基于官方 [select 选择器](https://2x.antdv.com/components/select-cn) |
| textarea | 基于官方 [Input 文本域](https://2x.antdv.com/components/input-cn#components-input-demo-textarea) |
| input-number | 基于官方 [InputNumber 数字输入框](https://2x.antdv.com/components/input-number-cn) |
| input | 基于官方 [Input 输入框](https://2x.antdv.com/components/input-cn) |
| time-picker | 基于官方 [TimePicker 时间选择框](https://2x.antdv.com/components/time-picker-cn) |
| date-picker | 基于官方 [DatePicker 日期选择框](https://2x.antdv.com/components/date-picker-cn) |
| range-picker | 基于官方 [DatePicker 日期选择框](https://2x.antdv.com/components/date-picker-cn)中的`range-picker`日期范围选择器 |
| checkbox | 基于官方 [Checkbox 多选框](https://2x.antdv.com/components/checkbox-cn)中的`checkbox-group` |
| radio-group | 基于官方 [Radio 单选框](https://2x.antdv.com/components/radio-cn)中的`radio-group` |

## 单独使用案例

参考案例：`apps\finance-admin\src\views\accountManage\basicSettings\accountTitle\components\AssistCountting\AssistCountting.vue`

![image-20250728111942509](https://s2.loli.net/2025/07/28/Q8pCRMbJHWZvrgt.png)

![image-20250728111521693](https://s2.loli.net/2025/07/28/AEMl68WKoZaRTfv.png)

# FormPage

`FormPage`是项目中构建表单的组件，使用 JS 配置渲染出不同类型的组件。

## props

| 参数          | 说明             | 类型            | 默认值                           |
| :------------ | :--------------- | :-------------- | :------------------------------- |
| formModel     | 表单字段模型     | Array           | []                               |
| formData      | 表单数据         | Object          | {}                               |
| labelCol      | label样式        | Object          | { style: { minWidth: '100px' } } |
| wrapperCol    | 控件样式         | Object          | { span: 17 }                     |
| labelAlign    | 标签文本对齐方式 | String          | 'left'                           |
| loading       | 是否显示loading  | Boolean         | false                            |
| asChild       | 作为子组件       | Boolean         | false                            |
| verticalGap   | 字段垂直间隔     | String / Number | '0'                              |
| extraHeight   | 表单容器多余高度 | String / Number | 0                                |
| layout        | 表单布局         | String          | 'horizontal'                     |
| colspan       | 字段colspan      | Number          | 24                               |
| gutter        | 表单间隔         | Array           | [12, 0]                          |
| disabled      | 是否禁用         | Boolean         | undefined                        |
| fieldsetStyle | fieldset样式     | Object \ String | {}                               |
| autocomplete  | 自动完成属性     | String          | 'on'                             |

## formModel数据格式

column里面的属性为`FormItem`的属性

```js
const otherColumn = {
        title: '其他信息',
        style:{},
        column: [
            {
                el: 'textarea',
                label: '内容及要求',
                name: 'contentAndRequirements',
                props: {
                    placeholder: '请输入',
                    style: {},
                },
            },
             {
                el: 'a-select',
                label: '项目类型',
                name: 'projectTypeCode',
                colspan: 12,
                options: smallProjectTypeList,
                rules: [{ required: true, message: '请选择项目类型' }],
            },
            ...
          ]
}
```

与`FormModal`组件的数据格式一样。

## methods

| 方法名                 | 说明                                                         | 参数                                                         |
| :--------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| clearValidate          | 移除表单项的校验结果。传入待移除的表单项的 name 属性或者 name 组成的数组，如不传则移除整个表单的校验结果 | (nameList?: [NamePath](https://www.antdv.com/components/form-cn#namepath)[]) => void |
| resetFields            | 对整个表单进行重置，将所有字段值重置为初始值并移除校验结果   | (nameList?: [NamePath](https://www.antdv.com/components/form-cn#namepath)[]) => void |
| scrollToField          | 滚动到对应字段位置                                           | (name: [NamePath](https://www.antdv.com/components/form-cn#namepath), options: [[ScrollOptions](https://github.com/stipsan/scroll-into-view-if-needed/tree/ece40bd9143f48caf4b99503425ecb16b0ad8249#options)]) => void |
| scrollToFields         | 多列表单时，支持多列滚动到对应字段位置                       | (name: [NamePath](https://www.antdv.com/components/form-cn#namepath), options: [[ScrollOptions](https://github.com/stipsan/scroll-into-view-if-needed/tree/ece40bd9143f48caf4b99503425ecb16b0ad8249#options)]) => void |
| validate               | 触发表单验证, 同 validateFields                              | (nameList?: [NamePath](https://www.antdv.com/components/form-cn#namepath)[]) => Promise |
| validateFields         | 触发表单验证                                                 | (nameList?: [NamePath](https://www.antdv.com/components/form-cn#namepath)[]) => Promise |
| getSelectedAddressName | 当表单中使用了`city-picker`时，获取选中的地区数据            | (name?:String) => Object: `SelectedAddressName`              |

- type: `SelectedAddressName`

```ts
interface SelectedAddressName {
    province: Record<string, any>
    city: Record<string, any>
    area: Record<string, any>
    street: Record<string, any>
    village: Record<string, any>
}
```

### setTitleComponent

设置自定义标题样式

```js
import FormPageModelTitle from '../components/FormPageModelTitle/index.vue'

FormPage.setTitleComponent(FormPageModelTitle)
```

## 设置自定义标题 & 插槽

案例路径：`apps\finance-admin\src\views\approvalCenter\contractApproval\contractApprovalApply.vue`

![image-20250728115044582](https://s2.loli.net/2025/07/28/OL6GxsS49ZqIa5g.png)

![image-20250728115146924](https://s2.loli.net/2025/07/28/QOjLdHthXzPIsAN.png)

## 使用案例

- 文件路径: `apps\finance-admin\src\views\approvalCenter\contractApproval\contractApprovalApply.vue`

![image-20250728113425158](https://s2.loli.net/2025/07/28/Q45k7AwfPYmt9u3.png)

![image-20250728113354620](https://s2.loli.net/2025/07/28/DbK84yfXZtsg5vu.png)

- 案例路径(产权)：`apps\property-admin\src\views\smallProject\applyBid\apply.vue`![image-20250728140926493](https://s2.loli.net/2025/07/28/3fE1U2bTv7DXu6r.png)

# FormModal

`FormModal`是基于`FormPage`二次封装的弹窗表单组件，传入的数据结构与`FormPage`一致，不同点只是多了一层弹窗，formModel的数据结构与`FormPage`一致。

## props

| 参数               | 说明                           | 类型            | 默认值                           |
| :----------------- | :----------------------------- | :-------------- | :------------------------------- |
| modalTitle         | 弹窗标题                       | String          | '标题'                           |
| show               | 是否显示                       | Boolean         | false                            |
| formModel          | 表单字段模型                   | Array           | []                               |
| formData           | 表单数据                       | Object          | {}                               |
| labelCol           | label样式                      | Object          | { style: { minWidth: '100px' } } |
| wrapperCol         | 控件样式                       | Object          | { span: 17 }                     |
| labelAlign         | 标签文本对齐方式               | String          | 'right'                          |
| modalWidth         | 弹窗宽度                       | String / Number | '500px'                          |
| cancelText         | 重置按钮文字，传空则不显示按钮 | String          | '取消'                           |
| confirmText        | 搜索按钮文字，传空则不显示按钮 | String          | '确认'                           |
| gutter             | 表单间隔                       | Array           | [12, 0]                          |
| okBtnLoading       | 表单确按钮loading              | Boolean         | false                            |
| showCancelBtn      | 是否显示取消按钮               | Boolean         | true                             |
| showConfirmBtn     | 是否显示确认按钮               | Boolean         | true                             |
| showFooter         | 是否显示footer                 | Boolean         | true                             |
| autoClose          | 自动关闭                       | Boolean         | true                             |
| fieldsetStyle      | fieldset样式                   | Object / String | {}                               |
| showFullScreenIcon | 是否显示全屏                   | Boolean         | true                             |
| autocomplete       | 自动完成属性                   | String          | 'on'                             |

## methods

| 方法名         | 说明                                                         | 参数                                                         |
| :------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| clearValidate  | 移除表单项的校验结果。传入待移除的表单项的 name 属性或者 name 组成的数组，如不传则移除整个表单的校验结果 | (nameList?: [NamePath](https://www.antdv.com/components/form-cn#namepath)[]) => void |
| resetFields    | 对整个表单进行重置，将所有字段值重置为初始值并移除校验结果   | (nameList?: [NamePath](https://www.antdv.com/components/form-cn#namepath)[]) => void |
| scrollToField  | 滚动到对应字段位置                                           | (name: [NamePath](https://www.antdv.com/components/form-cn#namepath), options: [[ScrollOptions](https://github.com/stipsan/scroll-into-view-if-needed/tree/ece40bd9143f48caf4b99503425ecb16b0ad8249#options)]) => void |
| scrollToFields | 多列表单时，支持多列滚动到对应字段位置                       | (name: [NamePath](https://www.antdv.com/components/form-cn#namepath), options: [[ScrollOptions](https://github.com/stipsan/scroll-into-view-if-needed/tree/ece40bd9143f48caf4b99503425ecb16b0ad8249#options)]) => void |
| validate       | 触发表单验证, 同 validateFields                              | (nameList?: [NamePath](https://www.antdv.com/components/form-cn#namepath)[]) => Promise |
| validateFields | 触发表单验证                                                 | (nameList?: [NamePath](https://www.antdv.com/components/form-cn#namepath)[]) => Promise |

## 使用案例

案例路径：`apps\finance-admin\src\views\bookkeeping\cashierBookkeeping\index.vue`

![image-20250728151255110](https://s2.loli.net/2025/07/28/7J8oNX64gmxsFDp.png)

- 数据结构案例：`apps\finance-admin\src\views\bookkeeping\cashierBookkeeping\composables\useFormModal.js`

  ![image-20250728152040355](https://s2.loli.net/2025/07/28/pyon1MBYj5C7uq9.png)

  ![image-20250728152108228](https://s2.loli.net/2025/07/28/o3Ouvl5D8BnPWtE.png)

## city-picker的使用

`city-picker`为自定义`FormItem`子组件的其中一个，在`FormPage`/`FormModal`中作为`column`的一个元素使用。

```js
{
  el: 'city-picker',
    label: '分行/支行所在区域',
      addRequiredMark: true,
        columnGroup: [
          {
            name: 'provinceCode',
            rules: [{ required: true, message: '请选择省份' }],
          },
          {
            name: 'cityCode',
          },
          {
            name: 'areaCode',
          },
          {
            name: 'streetCode',
            display: false,
          },
        ],
},
```

- 使用案例1：`apps\finance-admin\src\views\accountManage\basicSettings\bankAccount\composables\useFormModal.js`

  ![image-20250728155433927](https://s2.loli.net/2025/07/28/FJN9uk85wtO2ADg.png)

- 使用案例2: `apps\finance-admin\src\views\systemManage\organizationManage\composables\useOrganizationModal.js`

  ![image-20250728155538974](https://s2.loli.net/2025/07/28/d1Q8KU3gGDF5sei.png)

## city-picker的调试

参考路径:`apps\finance-admin\src\setup\uiFramework.js`

如果需要调试组件，同时不需要重新打包`x-widgets`，可以从`'x-widgets/origin'`引用组件，并再次注册接口。

```
import { CityPicker as OriginCityPicker } from 'x-widgets/origin'
```

![image-20250728173012958](https://s2.loli.net/2025/07/28/AGtNUQMkp6KxoLl.png)

# SearchForm

`SearchForm`里面的数据格式跟`FormPage`的一样，都是基于`FormItem`二次封装。

## props

| 参数          | 说明                                       | 类型    | 默认值     |
| :------------ | :----------------------------------------- | :------ | :--------- |
| column        | 表单项配置（CustomFormItemProps 数组）     | Array   | []         |
| formData      | 表单数据对象                               | Object  | {}（必填） |
| resetText     | 重置按钮文字，传空则不显示按钮             | String  | '重置'     |
| searchText    | 搜索按钮文字，传空则不显示按钮             | String  | '查询'     |
| loading       | 加载中                                     | Boolean | false      |
| gutter        | 表单项间隔                                 | Array   | [12, 12]   |
| disabled      | 是否禁用                                   | Boolean | false      |
| layout        | 表单布局方式（horizontal/vertical/inline） | String  | 'inline'   |
| enabledExpand | 是否开启展开收起功能                       | Boolean | true       |
| showButtons   | 是否显示操作按钮                           | Boolean | true       |

## 参考案例

1. `apps\finance-admin\src\views\accountStatistics\contactStatistics\composables\useSearchForm.js`
   ![image-20250728180311581](https://s2.loli.net/2025/07/28/C18kcqDRnN6Gjdo.png)
2. `apps\finance-admin\src\views\bookkeeping\cashierBookkeeping\composables\useSearchForm.js`
   ![image-20250728180343753](https://s2.loli.net/2025/07/28/J5du1XOvLGUpnSs.png)

# Print 打印模块

## 使用方法

调用打印功能，使用`goPrint`方法。(路径：`apps\finance-admin\src\utils\tool.ts`)

```js
import { goPrint } from '@/utils'

goPrint('/financeBook/detailsClassification/print', params, {
  title: '明细分类账',
  signShow: false,
})
```

参数：

1. 打印的页面路径
2. 当前请求的参数
3. 打印配置，每个页面需要设置不同title

调用后弹出打印弹窗：
![image-20250728163821028](https://s2.loli.net/2025/07/28/TwWYs6XtORJNlIk.png)

点击打印后会调出打印预览。

![image-20250728164429585](https://s2.loli.net/2025/07/28/EuzSCgMjiGpwVJX.png)

## 打印页调试

把图中的注释解开，即可跳转到打印页，调试页面。

![image-20250728164245130](https://s2.loli.net/2025/07/28/wf4i6COadPtukLq.png)

![image-20250728164454934](https://s2.loli.net/2025/07/28/wmcuJg18I4WFA9N.png)

## 打印配置

| 参数                  | 说明                                                     | 类型        | 默认值 |
| :-------------------- | :------------------------------------------------------- | :---------- | :----- |
| usePrintSetting       | 是否使用打印设置弹窗                                     | boolean     | -      |
| title                 | 打印标题                                                 | string      | -      |
| direction             | 纸张方向：1-纵向，2-横向                                 | 1 / 2       | 1      |
| paginationShow        | 是否显示页码                                             | boolean     | true   |
| paper                 | 纸张类型                                                 | 'A3' / 'A4' | 'A4'   |
| paddingLeft           | 左边距（mm）                                             | number      | 10     |
| paddingTop            | 上边距（mm）                                             | number      | 7      |
| paddingRight          | 右边距（mm）                                             | number      | 10     |
| paddingBottom         | 下边距（mm）                                             | number      | 7      |
| titleLineHeight       | 标题行高度（mm）                                         | number      | 9      |
| dataLineHeight        | 数据行高度（mm）                                         | number      | 9      |
| fontSize              | 字体大小（px）                                           | number      | 12     |
| paginationLocation    | 页码显示位置：1-左侧，2-中间，3-右侧                     | number      | 3      |
| signShow              | 是否显示落款                                             | boolean     | true   |
| tableWidth            | 单元格内容宽度模式：1-自适应，2-最大宽度                 | number      | 1      |
| paginationFixed       | 页码是否固定底部                                         | boolean     | false  |
| printDateShow         | 是否显示打印日期                                         | boolean     | true   |
| voucherCount          | 凭证打印每页凭证数量                                     | number      | 1      |
| voucherAlign          | 凭证排列方式：1-从上到下，2-居中，3-两端对齐，4-平均分配 | number      | 4      |
| dataFontLineHeight    | 数据行间距（px）                                         | number      | 14     |
| voucherLineFixed      | 凭证打印是否固定行数                                     | boolean     | true   |
| voucherLine           | 凭证打印固定行数                                         | number      | 6      |
| styleSettingShow      | 是否显示样式设置区域                                     | boolean     | true   |
| paginationSettingShow | 是否显示页码设置区域                                     | boolean     | true   |
| footerSettingShow     | 是否显示footer设置区域                                   | boolean     | true   |
| marginSettingShow     | 是否显示边距设置区域                                     | boolean     | true   |

## 设置打印页面的样式

参考案例：`apps\finance-admin\src\views\financeBook\detailsClassification\print\print.tsx`

```ts
import {
  usePrint,
  getRouteQuery
} from 'x-utils'

const { setPageStyle, reset, getPageSize } = usePrint()
const pageSize = getPageSize() // 获取页数
const { uid } = getRouteQuery()

onBeforeMount(() => {
  setPageStyle() // 设置页面样式
  getData()
})

function getData() {
  ...
  setTimeout(() => {
    if (dataList.value.length > 0 && print !== 'false') {
      _totalPage.value = currentPage
      if (debug !== '1') {
        window.onafterprint = function () {
          window.close()
          window.parent.postMessage('closeVoucherPrintWindow', '*')
          reset(uid) // 调用重置方法，关闭弹窗
        }
      }
      setTimeout(() => {
        window.print()
      })
    } else {
      reset(uid)
    }
  })
    ...
}
```



# 数据统计

页面地址：[广东省农村集体资产监督管理平台](http://localhost:7001/accountStatistics/contactStatistics)

![image-20250728172153252](https://s2.loli.net/2025/07/28/61AP4eckM98TbGl.png)

所有统计页面的核心功能就是地区的下钻与返回，相关代码如下：

文件路径：`apps\finance-admin\src\views\accountStatistics\contactStatistics\composables\useTable.js`

![image-20250728172712033](https://s2.loli.net/2025/07/28/cS8iGRZ1pnDohaf.png)
