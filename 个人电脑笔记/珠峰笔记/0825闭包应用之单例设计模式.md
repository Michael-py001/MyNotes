### 闭包应用之单例设计模式

> 在业务开发中，在一个项目中多个程序员写的不同代码会存在写了相同的变量，造成全局变量污染，对此，为了防止“全局变量污染”有以下方案。

#### 方案1:闭包/私有上下文  =>保护

```js
(function () {
    let name = "lili";
    let age = 21;
    let sex = '男';
    let friends = ["马云", "马化腾"];
})();
//在不同的闭包里，变量得到了保护
(function () {
    let name = "Michael";
    let age = 22;
    let sex = "man";
    let friends = ["马云"];
})();
```

#### 方案2:对象 =>分组

> 把描述同一个事物的属性和方法都放置在相同的空间(堆内存)中

```js
let person1 = {
    name: 'lili',
    age: 21
};

let person2 = {
    name: 'Jack Ma',
    age: 28
};
```

#### 方案三：暴露到全局window

> 瑕疵：不能给全局下暴露太多的方法，否则又出现“全局变量污染”

```js
// A
let AModule = (function () {
    let step = 0;
    function fn() {}
    function query() {}
    // 我们想把私有的东西暴露出去共外面调用（API）
    // 1. window.xxx=xxx  瑕疵：不能给全局下暴露太多的方法，否则又出现“全局变量污染”
    

})();

// B
(function () {
    let step = 0;
    function fn() {}
    window.query = query;//调用A里面的函数
})();

```

#### 终极方案----单例设计模式

> 原理：利用闭包的保护及对象的分组特征，结合在一起实现的，这是最早期的模块化编程

```js
// A
let AModule = (function () {
    let step = 0;
    function fn() {}
    function query() {}
    // 2. 基于返回对象（分组）的方法，把需要暴露的API，都放置到同一个空间下
    return {
        // query:query
        query,
        step
    };
})();

// B
(function () {
    let step = 0;
    function fn() {}
    AModule.query();//调用A里的函数
})();
```

**例子**

```js
// 工具库:大量公共的方法（有些方法是内部用的，有些是可以供外面调用的）
let utils = (function () {
    function getCss() {}
    function setCss() {}
    function css() {
        getCss();
        setCss();
    }
    return {  //返回的都是一个对象
        css
    };
})();

// 搜索模块
let SearchModule = (function () {
    let keyword = "";
    function handle() {}
    function query() {}
    utils.css();
    return {
        handle,
        // init:function(){}
        init() {
            // 控制业务板块中我们先执行谁，再执行谁：控制业务逻辑处理顺序的 “命令模式”
            query();
            handle();
        }
    };
})();
SearchModule.init();

// 资讯模块
let NewsModule = (function () {
    let data = [];
    function query() {}
    utils.css();
    SearchModule.handle();
    return {
        init() {

        }
    };
})();
NewsModule.init();
```

#### 为什么叫单例模式呢？

> 单例：单独的实例，每一个实例都是独立开来的，里面有很多自己的私有属性和方法

##### 每一个对象都是Object的单独实例

-  let obj={}; 字面量方式

  > 在JS中，创建对象的方式比较特殊，这样创建和let obj=new Object();没有区别，都是创建Object的单独实例

- let obj=new Object(); 构造函数方式

  > 后台语言中只能这样创建对象

##### 命名空间：俗称“对象名”

```js
let utils = {}//  {}是一个单独的空间，utils是空间名
```

##### 分组特征

把描述同一个事物的属性和方法，都放在同一个空间下

```js
let SearchModule = {};//
```

