## 可拖拽DIV实现的几种思路

### 一、

> 使用bind,getBoundingClientRect,this

```js
<script>
        // 解决鼠标焦点丢失问题
        //   + IE/火狐：把盒子和鼠标绑定在一起
        //     + setCapture
        //     + releaseCapture
        //   + 谷歌：猴子不管蹦哒的多欢，永远也逃离不出如来佛祖的五指山
        //     + 所有的原因是因为鼠标不在盒子上了，很多事件触发不了
        //     + 鼠标不管移动多快，也逃离不出去浏览器，所以mousemove/mouseup都绑定给window

        let box = document.querySelector('.box'),
            HTML = document.documentElement, //==>整个HTML
            minL = 0,
            minT = 0,
            // 最大边界 maxL-->盒子在右边的最大距离  maxT-->盒子在底部的最大距离
            maxL = HTML.clientWidth - box.offsetWidth, //HTML的视图宽度 - box自身宽度
            maxT = HTML.clientHeight - box.offsetHeight; //HTML的视图高度 - Box自身高度

        const down = function down(ev) {
            // this -> box
            let {
                top, //获取box上边距距离视图窗口(浏览器窗口)顶部的距离(有可能出现负数)
                left //box左边距距离视图窗口左边界的距离
            } = this.getBoundingClientRect();
            // 绑定自定义属性
            this.startT = top;
            this.startL = left;
            this.startX = ev.clientX; //鼠标在浏览器的水平坐标
            this.startY = ev.clientY; //鼠标在浏览器的垂直坐标

            // 注意：保证move/up中的this是盒子 并且 还要考虑好移除的时候如何移除
            this._move = move.bind(this);
            this._up = up.bind(this);
            window.addEventListener('mousemove', this._move);
            window.addEventListener('mouseup', this._up);
        };

        const move = function move(ev) {
            // this -> box
            // box的当前left/top = 当前鼠标位置 - 开始时鼠标位置 + box距离浏览器窗口的left/top距离
            let curL = ev.clientX - this.startX + this.startL,
                curT = ev.clientY - this.startY + this.startT;
            // 边界判断
            curL = curL < minL ? minL : (curL > maxL ? maxL : curL);
            curT = curT < minT ? minT : (curT > maxT ? maxT : curT);
            this.style.left = `${curL}px`;
            this.style.top = `${curT}px`;
        };

        const up = function up(ev) {
            // this -> box
            window.removeEventListener('mousemove', this._move);
            window.removeEventListener('mouseup', this._up);
        };

        box.addEventListener('mousedown', down);

        // HTML5中内置的拖拽事件：把目标元素拖拽到指定的区域中
        // https://developer.mozilla.org/zh-CN/docs/Web/API/Document/dragstart_event
    </script>
```

### 二、

> 饥人谷里的方案，设置move开关，dom一级事件，还差右边和底部的边界判断

```js
 <script>
        var div1 = document.getElementById("div1");
        var move = false;  //设置开关
        var lastX;
        var lastY;
        div1.onmousedown = function (e) {
            move = true; //开关变成true
            lastX = e.clientX;
            lastY = e.clientY;
        }
        document.onmousemove = function (e) {  // 使用document而不是div1，因为前者是整个页面文档，后者鼠标快速拖动就会失效
            if (move) {
                var deltaX = e.clientX - lastX;//计算出当前鼠标X 减去 按下鼠标的X
                var deltaY = e.clientY - lastY;
                var left = parseInt(div1.style.left) || 0;
                var top = parseInt(div1.style.top) || 0;
                var resultX = left + deltaX;   // 最终结果X坐标 = div的left + 鼠标移动差值
                var resultY = top + deltaY;
                if (resultX < 0) {  //优化鼠标移出页面左边时，div的left改成0
                    resultX = 0
                }
                if (resultY < 0) {
                    resultY = 0
                }
                div1.style.left = resultX + "px"; //left = 当前鼠标X 减去 上一次鼠标的X
                div1.style.top = resultY + "px";
                lastX = e.clientX;
                lastY = e.clientY;

            }
        }
        document.onmouseup = function () {
            console.log("鼠标提起")
            move = false;

        }
    </script>
```

### 三、

> 网上搜集，还差右边和底部的边界判断

```js
<script>
        window.onload = function () {
            var div1 = document.getElementById("div1")
            var firstX = 0;
            var firstY = 0;
            // 鼠标按下事件
            div1.onmousedown = function (e) {
                var firstX = e.clientX - div1.offsetLeft; //计算出【鼠标点击的坐标X-div左边界到浏览器左边界】的距离，即鼠标到div左边界的距离
                var firstY = e.clientY - div1.offsetTop;
                //鼠标拖动事件
                document.onmousemove = function (e) {
                    div1.style.left = e.clientX - firstX + "px";//鼠标X坐标 - X坐标到div左边距 = left
                    div1.style.top = e.clientY - firstY + "px";
                }
                // 鼠标松开事件
                document.onmouseup = function () {
                    document.onmousemove = null;  //鼠标松开时，清除鼠标事件
                }

            }
        }
    </script>
```

