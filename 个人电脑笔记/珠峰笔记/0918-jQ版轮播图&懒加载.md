## jQ版渐隐渐现轮播图&懒加载&防抖

### HTML

```js
<section class="container">
		<!-- 轮播图 -->
		<div class="wrapper">
			<div class="slide">
				<img src="" alt="" img-url="images/1.jpg">
			</div>
			<div class="slide">
				<img src="" alt="" img-url="images/2.webp">
			</div>
			<div class="slide">
				<img src="" alt="" img-url="images/3.webp">
			</div>
			<div class="slide">
				<img src="" alt="" img-url="images/4.webp">
			</div>
		</div>

		<!-- 分页器 -->
		<div class="pagination">
			<span class="active"></span>
			<span></span>
			<span></span>
			<span></span>
		</div>

		<!-- 导航按钮 -->
		<a href="javascript:;" class="btn btn-prev"></a>
		<a href="javascript:;" class="btn btn-next"></a>
	</section>
```

### JS

```js
// 防抖
function debounce(func, wait = 300, immediate = false) {
    let timer = null;
    return function anonymous(...params) {
        let now = immediate && !timer;

        // 每次点击都把之前设置的定时器清除
        clearTimeout(timer);

        // 重新设置一个新的定时器监听wait时间内是否触发第二次
        timer = setTimeout(() => {
            // 手动让其回归到初始状态
            timer = null;
            // wait这么久的等待中，没有触发第二次
            !immediate ? func.call(this, ...params) : null;
        }, wait);

        // 如果是立即执行
        now ? func.call(this, ...params) : null;
    };
}

(function () {
    let $container = $('.container'), //轮播图容器
        $slideList = $container.find('.slide'), //每一个图片slide
        $paginationList = $('.pagination span'), //分页器每一个点
        $btnPrev = $('.btn-prev'), //导航按钮 上一个
        $btnNext = $('.btn-next') //导航按钮 下一个

    let cur_step = 0, //当前步数
        pre_step = 0, //前一步的步数
        interval = 3000, //切换时间间隔
        timer = null //定时器
    console.log($slideList);

    // 进来第一件事，把第一张图片显示
    $slideList.eq(cur_step).css({
        zIndex: 1,
        opacity: 1
    })

    // 实现图片懒加载-->lazy_load接受一个jq选择器的node
    //@param img_slide 一个jq选择器的node
    const lazy_load = function (img_slide) {
        if (img_slide.isLoad) return
        let img = img_slide[0].querySelector("img"), //从传进来的jq元素获取原生元素
            real_url = img.getAttribute("img-url"), //获取Img标签上的真实img地址
            temp_img = new Image //创建一个临时img node
        if (!real_url) return //如果没有获取到真实地址则退出
        // 尝试加载临时图片的地址
        temp_img.src = real_url
        // 如果图片加载成功则开始在真实Img上设置真实Img地址
        temp_img.onload = function () {
            img.src = real_url;
            img_slide.css("opacity", 1)
        };
        // 清除临时图片
        temp_img = null
        // 移除img标签上临时图片地址
        img.removeAttribute("img-url")
        // 设置自定义属性，留着判断是否已经加载过
        img_slide.isLoad = true
    }
    lazy_load($slideList.eq(cur_step))
    // 执行就会切换下一张图片的方法
    const change = function () {
        let cur_slide = $slideList.eq(cur_step), //获取当前的slide
            pre_slide = $slideList.eq(pre_step) //获取上一个slide

        // 图片懒加载
        lazy_load(cur_slide)


        pre_slide.css({
            opacity: 0,
            zIndex: 0
        })
        cur_slide.css({
            opacity: 1,
            zIndex: 1
        })

        $paginationList.eq(cur_step).addClass("active")
        $paginationList.eq(pre_step).removeClass("active")

    }
    // 自动切换
    const autoChange = function () {
        pre_step = cur_step;
        cur_step++
        cur_step > 3 ? cur_step = 0 : null
        change()
    }
    // 定时器
    timer = setInterval(autoChange, interval)
    // 鼠标移上去时停止轮播，离开则继续轮播
    $container.mouseenter(function () {
        console.log("ok");
        clearInterval(timer)
    }).mouseleave(function () {
        timer = setInterval(autoChange, interval)
    })
    // 导航器-上一个
    $btnPrev.click(debounce(function () {
        pre_step = cur_step;
        cur_step--
        cur_step < 0 ? cur_step = 3 : null
        change()
    }, 300, true))
    // 导航器-下一个
    $btnNext.click(debounce(autoChange, 300, true))
    // 第一种方法
    $paginationList.each(function (index, item) {
        $(item).click(function () {
            let cur_index = $(item).index()
            if (cur_index === cur_step) return
            pre_step = cur_step
            cur_step = cur_index
            change()

        })
    })
    // 第二种方法
    // $paginationList.click(function () {
    //     let index = $(this).index();
    //     if (index === step) return;
    //     prev = step;
    //     step = index;
    //     change();
    // });

})()
```

