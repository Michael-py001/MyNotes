# 20240716-【正则】否定前瞻断言

> 需求：匹配数字，包含负数，去除其他字符。

使用的正则如下：

```js
emit('update:value', val?.replace(/(?!^-)[^\d.]/g, ''))
```

正则表达式 `(?!^-)[^\d.]` 由两个部分组成：否定前瞻 `(?!^-)` 和字符类 `[^\d.]`。让我们详细解析一下这两个部分：

## 否定前瞻 `(?!^-)`

- **`(?!...)`**：否定前瞻断言，表示在**当前位置后面的字符序列不能匹配括号内的模式**。
- **`^-`**：`^`表示字符串的开头  后面紧跟一个负号 `-`。

因此，`(?!^-` 表示当前位置后面不能是字符串的开头紧跟一个负号。

## 字符类 `[^\d.]`

- **`[^...]`**：否定字符类，表示匹配任何不在括号内的字符。
- **`\d`**：表示数字字符（0-9）。
- `.`：表示小数点字符。

因此，`[^\d.]` 表示匹配任何不是数字或小数点的字符。

## 组合 `(?!^-)[^\d.]`

当这两个部分组合在一起时，正则表达式 `(?!^-)[^\d.]` 的含义是：

- **`(?!^-)`**：当前位置后面不能是字符串的开头紧跟一个负号。
- **`[^\d.]`**：匹配任何不是数字或小数点的字符。

## 具体示例

假设你有以下字符串：

- `-123.45`：负号在开头，数字和小数点。
- `123-45`：负号在中间，数字和小数点。

应用正则表达式 `(?!^-)[^\d.]`：

- 对于 `-123.45`，负号在开头，所以 `(?!^-` 不匹配，`[^\d.]` 也不匹配任何字符。
- 对于 `123-45`，负号不在开头，所以 `(?!^-` 匹配，`[^\d.]` 匹配负号 `-`。

## 示例代码

以下是如何在代码中使用这个正则表达式来移除非数字和小数点的字符，同时保留开头的负号：

```js
const val = "-123-45.67";
const sanitizedVal = val.replace(/(?!^-)[^\d.]/g, '');
console.log(sanitizedVal); // 输出: -12345.67
```

## 解释

- **`val.replace(/(?!^-)[^\d.]/g, '')`**：将字符串 `val` 中所有不符合 `(?!^-)[^\d.]` 的字符替换为空字符串。+
- **`(?!^-)[^\d.]`**：匹配任何不是数字或小数点的字符，除非该字符是开头的负号。

通过这种方式，你可以确保负号只出现在字符串的开头，并且其他位置的负号和非数字字符会被移除。