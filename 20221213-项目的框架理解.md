## 项目的入口

项目启动时，会注册store、router、以及自定义的模块（setup里面）

![image-20221213172647335](https://f.pz.al/pzal/2022/12/13/9c32e7361548a.png)

setup包含的模块：

### 1. route.js：

路由守卫，检查是否登录状态，以及路由的白名单

### 2. request.js ：

对HttpRequest实例的进一步封装，比如添加请求错误提示

```js
//request.js
import HttpRequest from '@packages/utils/http/request';
export const request = new HttpRequest();
```

- `@packages/utils/http/request`下的request.js是一个基于axios封装的基础类，里面设置了很多拓展方法：比如设置请求、响应拦截方法，设置baseUrl等。

![image-20221213173808849](https://f.pz.al/pzal/2022/12/13/20c7e39068899.png)

​		`instance`是通过`axios.create()`创建出来的实例：

```js
createRequest(config) {
    this.instance = axios.create({ ...config });
    return this.instance;
  }
```

- `setup/request.js`是一个基于`@packages/utils/http/request`创建的实例。在里面使用了实例上的拓展方法，定义了具体的请求拦截规则、响应拦截规则、设置BaseUrl，以及挂在到app全局的方法：`$fetch`

  ```js
  app.config.globalProperties.$fetch = request.instance
  ```

### 3. api.js

使用`apiRegister`上的定义请求实例方法`setRequest`，把在`setup/request.js`创建的axios实例传进去，实现`apiRegister.apis`里面每个请求函数都通过这个axios实例发起请求。

> 此文件需要注册在request.js之后

```js
import apiRegister from '../../packages/api';

export default function (app) {
  apiRegister.setRequest(app.config.globalProperties.$fetch);
}
```

### 4. error.js

加载异常提示

### 5. index.js

把所有的模块导入，对外暴露一个install函数，把传进来的app传到各模块，按照顺序执行。

```js
import requestSetup from './request';
import apiSetup from './api';
import routeSetup from './route';
import errorSetup from './error';

const setup = {
  install(app) {
    requestSetup(app);
    apiSetup(app);
    routeSetup();
    errorSetup();
  },
};

export default setup;
```

## 