



```shell
#!/bin/bash

# è®°å½•å¼€å§‹æ—¶é—´
START_TIME=$(date +%s)
BUILD_START=$(date "+%Y-%m-%d %H:%M:%S")

# æ‰§è¡Œéƒ¨ç½²è„šæœ¬
sudo /data/code/scripts/gedi-tec/gedi-tec-deploy-ui.sh ${env} ${branch} ${module}

# è®°å½•éƒ¨ç½²ç»“æœ
DEPLOY_STATUS=$?

# æµ‹è¯•æ˜¯å¦åœ¨gitä»“åº“
if ! git rev-parse --is-inside-work-tree >/dev/null 2>&1; then
  echo "Not a git repository."
  exit 0
fi

# è·å–å½“å‰åˆ†æ”¯
CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)

# è·å–æœ€è¿‘çš„æäº¤ä¿¡æ¯
COMMIT_HASH=$(git log -n 1 --pretty=format:'%h')
COMMIT_TIME=$(git log -n 1 --pretty=format:'%ad' --date=format:'%m-%d %H:%M')
COMMIT_MSG=$(git log -n 1 --pretty=format:'%s' --no-merges)
EXTRA_MSG="ğŸŸBugå·²è§£å†³(éƒ¨åˆ†)ï¼Œå¯ä»¥è¿›è¡Œå›æµ‹"
COMMIT_AUTHOR=$(git log -n 1 --pretty=format:'%an')

# è®¡ç®—æ„å»ºè€—æ—¶
END_TIME=$(date +%s)
DURATION=$((END_TIME - START_TIME))
MINUTES=$((DURATION / 60))
SECONDS=$((DURATION % 60))

if [ $MINUTES -gt 0 ]; then
  DURATION_TEXT="${MINUTES}åˆ†${SECONDS}ç§’"
else
  DURATION_TEXT="${SECONDS}ç§’"
fi

# ç¯å¢ƒæ–‡æœ¬
if [ -z "$env" ]; then
  env="test"
fi

if [ "$env" = "test" ]; then
  ENV_TEXT="æµ‹è¯•ç¯å¢ƒ"
  ENV_COLOR="info"
elif [ "$env" = "main" ]; then
  ENV_TEXT="ç”Ÿäº§ç¯å¢ƒ"
  ENV_COLOR="warning"
else
  ENV_TEXT="æœªçŸ¥ç¯å¢ƒ"
  ENV_COLOR="comment"
fi

# æ„å»ºçŠ¶æ€
if [ $DEPLOY_STATUS -eq 0 ]; then
  STATUS_TEXT="âœ… æ„å»ºæˆåŠŸ"
  STATUS_COLOR="info"
else
  STATUS_TEXT="âŒ æ„å»ºå¤±è´¥"
  STATUS_COLOR="warning"
fi

# æ„å»ºtextæ¶ˆæ¯å†…å®¹
MESSAGE_JSON=$(cat << EOF
{
    "msgtype": "text",
    "text": {
        "content": "ğŸ“¦ ã€å‰ç«¯ã€‘æŠ€ç»é€ ä»·å¹³å°-è¾“ç”µ ${STATUS_TEXT}\n\nç¯å¢ƒï¼š${ENV_TEXT}  |  åˆ†æ”¯ï¼š${CURRENT_BRANCH}\næ„å»ºæ—¶é—´ï¼š${BUILD_START}  |  è€—æ—¶ï¼š${DURATION_TEXT}\n${EXTRA_MSG}",
        "mentioned_list": ["ex01494"]
    }
}
EOF
)

# å‘é€é€šçŸ¥
echo "${MESSAGE_JSON}" | iconv -f UTF-8 -t UTF-8 | \
 curl "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=fc1ad04b-c6f2-4f3f-94bf-f26e147be2bb" \
  -H "Content-Type: application/json; charset=utf-8" \
  --data-binary @-

echo ""
echo "é€šçŸ¥å·²å‘é€"

```

