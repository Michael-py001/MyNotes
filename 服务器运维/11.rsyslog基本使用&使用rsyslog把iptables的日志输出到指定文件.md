# 11.rsyslog基本使用&使用rsyslog把iptables的日志输出到指定文件

## 安装

在 Ubuntu 系统中，`rsyslog` 通常是默认安装的。你可以使用以下的命令来检查 `rsyslog` 是否已经安装：

```sh
rsyslogd -v
```

如果没有安装：

```sh
sudo apt update
sudo apt install rsyslog
```

## rsyslog的常用命令

- `service rsyslog start`：启动 `rsyslog` 服务。
- `service rsyslog stop`：停止 `rsyslog` 服务。
- `service rsyslog restart`：重启 `rsyslog` 服务。
- `service rsyslog status`：查看 `rsyslog` 服务的状态。

如果你修改了 `rsyslog` 的配置文件，你需要重启 `rsyslog` 服务来使新的配置生效。

你也可以使用 `logger` 命令来手动发送日志消息到 `rsyslog`，例如：

```sh
logger "This is a test log message"
```

这个命令会发送一条内容为 "This is a test log message" 的日志消息到 `rsyslog`。

## 查看rsyslog日志

在 Ubuntu 系统中，`rsyslog` 默认将日志文件存储在 `/var/log` 目录下。你可以使用 `ls` 命令来查看这个目录下的所有文件：

```bash
ls /var/log
```

其中，`syslog` 文件通常包含了系统的所有日志信息，`kern.log` 文件包含了内核的日志信息，`auth.log` 文件包含了认证相关的日志信息。

你可以使用 `cat`、`less` 或 `tail` 等命令来查看这些日志文件的内容。例如，以下的命令可以查看 `syslog` 文件的最后 10 行：

```bash
tail -n 10 /var/log/syslog
```

在这个命令中，`-n 10` 参数表示只显示最后 10 行。

## 用rsyslog把iptables的日志输出到指定文件

要使用 `rsyslog` 将 `iptables` 的日志输出到指定文件，你需要修改 `rsyslog` 的配置文件并重启 `rsyslog` 服务。以下是具体的步骤：

1. 打开 `rsyslog` 的配置文件。在大多数 Linux 系统中，配置文件的位置是 `/etc/rsyslog.conf`：

​		

```sh
sudo nano /etc/rsyslog.conf
#或者
sudo vim /etc/rsyslog.conf
```

在这个命令中，`sudo` 是用于获取 root 权限的命令，`nano` 是一个文本编辑器。

2. 在配置文件的末尾添加以下内容：

   ```sh
   :msg,contains,"iptables" /var/log/iptables.log
   & stop
   ```

   在这个配置中，`:msg,contains,"iptables: "` 是一个过滤器，它会匹配所有包含 "iptables: " 的日志消息，`/var/log/iptables.log` 是日志文件的路径，`& stop` 表示如果日志消息匹配了这个过滤器，那么就不再处理这个消息。

3. 保存并关闭配置文件。

4. 重启 `rsyslog` 服务：

   ```sh
   sudo service rsyslog restart
   ```

   

现在，所有 `iptables` 的日志都会被输出到 `/var/log/iptables.log` 文件中。

实时查看该日志文件：

```sh
tail -n 0 -f /var/log/iptables.log
```

