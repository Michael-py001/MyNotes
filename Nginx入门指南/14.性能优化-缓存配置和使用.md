# 14.性能优化-缓存配置和使用

缓存是提高Nginx性能的关键技术之一，它可以显著减少后端服务器的负载并提高响应速度。让我们详细探讨Nginx的缓存机制和配置方法。

## Nginx缓存的基本概念

Nginx可以作为一个反向代理缓存服务器，它能够缓存来自上游服务器（如你的Node.js应用）的响应。当相同的请求再次到来时，Nginx可以直接从缓存中返回响应，而不需要再次请求上游服务器。

## 配置proxy_cache

首先，我们需要在http块中定义一个缓存区：

```nginx
http {
  proxy_cache_path /path/to/cache levels=1:2 keys_zone=my_cache:10m max_size=10g 
    inactive=60m use_temp_path=off;

  server {
    listen 80;
    server_name api.iseeyu.icu;

    location / {
      proxy_cache my_cache;
      proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
      proxy_cache_valid 200 60m;
      proxy_cache_valid 404 10m;
      proxy_cache_key $request_uri;

      proxy_pass http://localhost:3000;
      add_header X-Cache-Status $upstream_cache_status;
    }
  }
}
```

让我们详细解释这个配置：

- `proxy_cache_path`: 定义缓存的存储位置和参数
  - `/path/to/cache`: 缓存文件存储的路径
  - `levels=1:2`: 设置缓存文件目录的层级，这里是两级目录